# LabPro - Прогресс разработки

## Текущий статус: Фаза 12 — Доработки и рефакторинг форм

### Завершённые фазы

#### Фаза 1: SQL-миграция — синхронизация схемы БД с кодом
- [x] Rename полей (type_id → container_type_id, status → container_status)
- [x] Добавить таблицы (notifications, equipment_logs, culture_type_tissue_types)
- [x] Расширить culture_types, container_types, tasks, equipment
- [x] Обновить триггеры (check_lot_closure)
- [x] P0 по умолчанию для первичной культуры
- [x] Seed-данные: tissue_types, culture_types, container_types, morphology_types, dispose_reasons

#### Фаза 2: Исправить API-функции
- [x] role в operation_containers для всех операций
- [x] FROZEN → IN_BANK в enum container_status
- [x] vial_count → cryo_vials_count
- [x] Убрать несуществующие поля из INSERT
- [x] Функция increment_passage_count

#### Фаза 3: Формы операций по ТЗ п.15
- [x] Observe — конфлюэнтность, морфология, контаминация, фото
- [x] Feed — FEFO, выбор партии, объём среды
- [x] Passage — split ratio, метрики, среды, время, позиция
- [x] Freeze — MCB/WCB, криовиалы, cells_per_vial, позиция, среды
- [x] Thaw — выбор банка, криовиалы, новый лот, позиция
- [x] Dispose — контейнеры/партии/среды, причина утилизации

#### Фаза 4: Карточки сущностей по ТЗ п.15
- [x] Culture — лоты + банки внутри, статистика
- [x] Lot — контейнеры + кнопки операций
- [x] Container — статус + размещение
- [x] Bank — QC + криовиалы
- [x] Donor — донации, история

#### Фаза 5: Списки и формы
- [x] Donors, Ready Media, Equipment, Orders, Tasks, QC, Inventory, Users

#### Фаза 6: Дашборд по ТЗ п.13
- [x] Статистика, быстрые действия, задачи, уведомления, реальные данные

#### Фаза 7: Бизнес-логика
- [x] Авто-задачи, авто-уведомления, FEFO, авто-закрытие лотов

#### Фаза 8: QR-сканер
- [x] Парсинг CNT:/EQP:/CULT:/POS:/RM:/BK:, навигация к карточкам

#### Фаза 9: Документы
- [x] Worksheet, Culture Passport, аудит-логи на карточках

#### Фаза 10: Чистка и безопасность
- [x] Удалён mock-data.ts, убран хардкод credentials, мобильное меню (Sheet), Toaster (sonner)

#### Фаза 11: Тестирование и багфиксы
- [x] Создание культуры: множественный выбор типов контейнеров в одной форме
- [x] Операции: redirect на карточку культуры после операции
- [x] Контейнеры: поле container_status вместо status
- [x] Утилизированные контейнеры: защита от повторных операций
- [x] Тип операции SEED, FEEDING, QC — метки в интерфейсе
- [x] Тип культуры: fallback если нет связи tissue_type → culture_type

#### Фаза 12: Доработки форм + схема номенклатур
- [x] БД: заполнены surface_area_cm2, volume_ml, optimal_confluent для container_types
- [x] БД: новые типы контейнеров DISH-35, DISH-60, DISH-100
- [x] БД: номенклатуры привязаны к container_types через FK (container_type_id)
- [x] Форма пассажа: полная перезапись (5 шагов: Источник → Среды → Метрики → Результат → Подтверждение)
- [x] Форма пассажа: среда диссоциации + промывки обязательны (шаг 2)
- [x] Форма пассажа: питательная среда для посева обязательна (шаг 4)
- [x] Форма пассажа: доступ к готовым средам + реагентам/ферментам/буферам
- [x] Форма пассажа: тип контейнера с отображением площади и остатков на складе
- [x] Форма пассажа: размещение (инкубатор) — обязательное поле
- [x] Форма пассажа: расчёт плотности посева (кл/см²)
- [x] Форма создания культуры: отображение остатков склада по container_type_id FK
- [x] Убраны все __none__ SelectItem (вызывали ошибку UUID parse в Supabase)
- [x] Страница Справочники: таб "Склад" перенаправляет на /inventory
- [x] API: getContainerStockByType() — загрузка складских остатков по container_type_id
- [x] API: getReagentBatches() — загрузка сред/реагентов/буферов для форм операций

### Статистика

| Метрика | Значение |
|---------|----------|
| Страницы | 38 маршрутов |
| UI-компоненты | 20 (shadcn/ui) |
| API (api.ts) | ~2950 строк |
| Типы (index.ts) | ~730 строк |
| SQL миграции | 8 файлов |

### Стек: Next.js 16.1.6 + TypeScript 5.9.3 + React 19.2.3 + Tailwind 4 + Supabase + Vercel

---

*Обновлено: 08.02.2026*
