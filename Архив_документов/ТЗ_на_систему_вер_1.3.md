# Система прослеживаемости клеточных культур и учёта инвентаря LabPro

**Версия:** 1.3
**Дата:** 30.01.2026
**Предыдущая версия:** 1.2 от 30.01.2026

---

## История версий

| Версия | Дата | Описание изменений |
|--------|------|-------------------|
| 1.0 | 27.01.2026 | Первичная версия ТЗ |
| 1.1 | 28.01.2026 | Консолидированная версия |
| 1.2 | 30.01.2026 | Добавлены справочники, исправлены правила закрытия лота, формулы, аутентификация |
| 1.3 | 30.01.2026 | Готовые среды, заявки, QC, дашборд, два сценария выдачи, прогноз клеток |

---

## 1. Назначение

Система **LabPro** предназначена для лабораторного ведения клеточных культур и обеспечивает:

- учёт доноров и донаций;
- создание и ведение культур и их веток (лотов);
- учёт контейнеров (чашки/флаконы/криовиалы) с QR-этикетками;
- журнал манипуляций и метрик;
- учёт инвентаря (среды/добавки/энзимы в мл, пластик/криопластик в шт), FEFO-подсказки, списания и корректировки;
- учёт оборудования, дат обслуживания/валидации, размещение контейнеров по позициям хранения;
- формирование документов "Рабочий лист" и "Паспорт культуры" (PDF) на основании истории;
- учёт заявок от заказчиков;
- модуль контроля качества (QC);
- справочник готовых питательных сред;
- дашборд с задачами и уведомлениями.

---

## 2. Термины и сущности

- **Донор** — физическое лицо, от которого получена ткань.
- **Донация** — факт получения ткани от донора.
- **Культура** — корневой объект, привязанный к одной донации.
- **Лот культуры (ветка)** — независимая ветка истории внутри культуры.
- **Контейнер** — физическая единица: посуда или криовиала.
- **Банк** — набор криовиал, созданных одной операцией заморозки (МБ или РБ).
- **Позиция хранения** — узел иерархии внутри оборудования.
- **Манипуляция** — операция (осмотр, подкормка, пассаж, заморозка, разморозка и т.д.).
- **Событие** — запись в неизменяемом журнале.
- **Готовая среда** — приготовленная питательная среда из компонентов справочника.
- **Заявка** — запрос от заказчика на создание МБ или выдачу клеток.
- **QC-тест** — тест контроля качества (микоплазма, стерильность и т.д.).

---

## 3. Роли (v1)

**Оператор** — выполняет все операции с культурами, инвентарём, формирует документы.

**Администратор** — управляет справочниками, оборудованием, пользователями, шаблонами печати.

**QA-специалист** — проводит QC-тесты, подтверждает качество банков/культур.

---

## 4. Бизнес-правила

### 4.1 Принцип работы

Пользователь работает от Культуры, внутри — от Лотов. Любая манипуляция выполняется на всех или части контейнеров выбранного лота.

### 4.2 Неизменяемость журнала

- Записи событий НЕ редактируются и НЕ удаляются.
- Изменения состояния выполняются ТОЛЬКО через создание события.
- Исправления — через корректирующее событие с `corrects_event_id`.

### 4.3 Ветвление (split) лота

Split создаётся как следствие манипуляции на части контейнеров:
- Пассаж (части контейнеров)
- Заморозка (части контейнеров)
- Разморозка (P_vial < P_lot)

При split:
- Новый лот создаётся с `parent_lot_id`
- Контейнеры-источники остаются в исходном лоте (статус Израсходован)
- Новые контейнеры создаются в новом лоте

### 4.4 Разморозка и пассаж

Правило `P_vial` vs `P_lot`:
- Если `P_vial = P_lot` → продолжается в том же лоте
- Если `P_vial < P_lot` → создаётся новый лот и split
- Если `P_vial > P_lot` → операция запрещена

### 4.5 Закрытие лота (v1.2)

**Автоматическое закрытие:**

Лот закрывается АВТОМАТИЧЕСКИ, когда все его контейнеры переходят в статус Израсходован или Утилизирован.

При закрытии система автоматически:
1. Меняет статус лота на **Закрыт**
2. Устанавливает `closed_at` = timestamp события
3. Устанавливает `closed_by_id` = user_id последней операции

Ручное закрытие в v1.3 **отсутствует**.

### 4.6 FEFO

Принцип FEFO по полю `expires_at`. Предупреждение при использовании не-FEFO/просроченной партии.

### 4.7 Статус донации

- **QUARANTINE** — тесты в процессе, выдача запрещена
- **APPROVED** — готово к использованию
- **REJECTED** — отклонено (результаты тестов положительные)

### 4.8 Размещение контейнеров

| Операция | Размещение | Примечание |
|----------|------------|------------|
| Пассаж | Инкубатор (WORK) | **Обязательно** |
| Разморозка | Инкубатор (WORK) | **Обязательно** |
| Заморозка | Криохранилище (STORAGE) | **Обязательно** |
| Выдача | Опционально | Можно пропустить |
| Утилизация | Опционально | Можно пропустить |

---

## 5. Коды и QR

### 5.1 Генерация кодов

- Донор: `D-0001 … D-9999`
- Донация: `DN-0001 … DN-9999`
- Культура: `CT-0001 … CT-9999`
- Заявка: `ORD-0001 … ORD-9999`
- Готовая среда: `RM-0001 … RM-9999`

### 5.2 Код контейнера

Посуда: `{КОД_КУЛЬТУРЫ}-L{ЛОТ}-P{ПАССАЖ}-{ВИД}-{NNN}`
- ВИД: `FL` (флакон), `DSH` (чашка)
- ЛОТ: L1, L2, L3... (сквозная нумерация внутри культуры)

Пример: `CT-0007-L1-P2-FL-003`

Криовиала: `{КОД_КУЛЬТУРЫ}-L{ЛОТ}-{БАНК}-V{NNN}`
- БАНК: `MCB` или `WCB`

Пример: `CT-0007-L1-WCB-V012`

### 5.3 QR-форматы

| Сущность | QR-формат | Пример |
|----------|-----------|--------|
| Контейнер | `CNT:{code}` | `CNT:CT-0001-L1-P2-FL-003` |
| Оборудование | `EQP:{code}` | `EQP:INC-001` |
| Позиция | `POS:{id}` | `POS:456` |
| Партия инвентаря | `INV:{id}` | `INV:123` |
| Культура | `CULT:{code}` | `CULT:CT-0001` |
| Готовая среда | `RM:{code}` | `RM:RM-0001` |
| Заявка | `ORD:{code}` | `ORD:ORD-0001` |

---

## 6. Состояния объектов

### 6.1 Контейнер

- **Активен** — в работе
- **На хранении** — размещён в позиции STORAGE
- **Израсходован** — использован в операции или выдан
- **Утилизирован** — утилизирован

### 6.2 Лот

- **Активен**
- **Закрыт** — автоматически при закрытии всех контейнеров
- **Утилизирован**

### 6.3 Донация

- **QUARANTINE** — тесты в процессе
- **APPROVED** — готово
- **REJECTED** — отклонено

### 6.4 Готовая среда

- **QUARANTINE** — карантин (нельзя использовать)
- **ACTIVE** — активна (доступна)
- **CONSUMED** — израсходована полностью

### 6.5 Заявка

- **NEW** — новая
- **IN_PROGRESS** — в работе
- **COMPLETED** — выполнена
- **CANCELLED** — отменена

### 6.6 QC-тест

- **PENDING** — ожидает
- **PASSED** — пройден
- **FAILED** — не пройден

---

## 7. Манипуляции

### 7.1 Создание культуры

Ввод: донация, способ получения (справочник), контейнеры, размещение (обязательно — инкубатор).

**Поля для методов:**
- Солидная ткань: среда для диссоциации, среда для отмывки
- Жидкая ткань: градиентная среда ИЛИ изотоническая среда

**Время процедуры:** начало / окончание (авторасчёт duration_minutes)

**Прогноз клеток:** система рассчитывает ожидаемое количество на основе истории

Результат: культура, лот L1 (P0), контейнеры Активен.

### 7.2 Осмотр

Ввод: лот, контейнеры, конфлюэнтность (общая или по каждой посуде), морфология (справочник), контаминация (справочник), фото.

**Автоматический интервал:** 3 дня (можно отменить/перенести)

### 7.3 Подкормка

Ввод: лот, контейнеры, партия среды или готовая среда, объём (мл).

**Автоматический интервал:** 3 дня (можно отменить/перенести)

Списание: объём из партии среды или готовой среды.

### 7.4 Пассаж

Ввод: лот, контейнеры-источники, партии инвентаря/готовые среды, метрики (концентрация, объём, жизнеспособность), результат (тип + количество).

**Среды:** диссоциация, отмывка, инактивация (из справочника готовых сред)

**Время:** начало / окончание процедуры

**Прогноз:** расчёт ожидаемого количества клеток

**Split:** только если выбрана часть контейнеров

Расчёты:
- Всего клеток = концентрация × объём суспензии
- Живых клеток = всего × жизнеспособность

Результат: исходные → Израсходован, новые → Активен, пассаж = P+1.

### 7.5 Создание банка (заморозка)

Правило МБ/РБ: первое событие → МБ, последующие → РБ.

Ввод: лот, контейнеры-источники, тип банка, метрики, тип заморозки (PROGRAMMED/MANUAL_80), среды (диссоциация, отмывка, заморозка), объём на виалу, количество виал, время, размещение (обязательно — криохранилище).

**Среды для снятия клеток:**
- Среда для диссоциации (энзим)
- Среда для отмывки
- Среда для заморозки с криопротектором

**Время:** freeze_started_at, freeze_ended_at, placed_in_cryo_at

### 7.6 Разморозка

Ввод: криовиала, партия среды или готовая среда, метрики после разморозки, размещение (обязательно — инкубатор).

Применяется правило `P_vial` vs `P_lot` (п. 4.4).

### 7.7 Размещение

Ввод: контейнеры, оборудование + позиция.

Проверка вместимости (capacity).

**Обязательность:** см. п. 4.8

### 7.8 Выдача — два сценария

**Сценарий А: Простая выдача (замороженные виалы)**

Ввод: криовиалы, получатель, цель, дата.

Результат: виалы → Израсходован.

**Сценарий Б: Выдача с манипуляцией (разморозка + упаковка)**

Ввод:
- Криовиалы для разморозки
- Среда для отмывки (из инвентаря или готовая)
- Метрики после разморозки (концентрация, жизнеспособность)
- Упаковка: тип контейнера, количество, объём на контейнер
- Получатель, цель, дата

Результат:
- Криовиалы → Израсходован
- Создаются новые контейнеры с размороженными клетками
- Новые контейнеры → Израсходован (выданы)

### 7.9 Утилизация

Ввод: объект (контейнеры/лот/культура), причина (справочник).

### 7.10 Процедура выделения (ISOLATION) — новый тип

Ввод:
- Метод: ферментативный / эксплант / градиент / изотонический
- Среда для диссоциации (для солидных тканей)
- Среда для отмывки
- Градиентная среда или изотоническая (для жидких тканей)
- Время начала / окончания
- Результат: контейнеры с культурой

Применяется при создании культуры из донации.

---

## 8. Метрики и расчёты (v1.2)

### 8.1 Формулы (v1.2)

**PD (Population Doubling):**
```
PD = log2(N_final / N_initial)
```

**CPD (Cumulative Population Doubling):**
```
CPD = Σ PD всех пассажей от CULTURE_CREATE
```

**PD/day (скорость роста):**
```
PD/day = PD / days_between_measurements
```

Где N = количество клеток (концентрация × объём суспензии).

При невозможности рассчитать → NULL.

### 8.2 Прогноз количества клеток (v1.3)

Система рассчитывает ожидаемое количество клеток на основе истории:

```
1. Средняя плотность клеток на см² при 70% конфлюэнтности (из прошлых данных)
2. Площадь контейнеров в лоте (из справочника типов)
3. Текущий день от последнего пассажа/посева
4. Коэффициент роста (на основе PD/day)

estimated_cells = SUM(container_area_cm2 × density_per_cm2 × confluence_factor × days_factor)
```

Отображается в карточке культуры/лота.

### 8.3 Сохраняемые метрики

- Осмотр: confluence_percent, morphology_id, contamination_flag, contamination_note
- Пассаж/Заморозка/Разморозка: cells_per_ml, suspension_volume_ml, viability_percent

### 8.4 Производные

- Всего клеток = концентрация × объём суспензии
- Живых клеток = всего × жизнеспособность
- Время до 70% конфлюэнтности

---

## 9. Модель данных (PostgreSQL)

### 9.1 Пользователи

```
users(id, login, password_hash, full_name, role, is_active, created_at)
```

### 9.2 Доноры/Донации

```
donors(id, donor_code, fio, sex, birth_date, contacts, note, created_at)

donations(id, donation_code, donor_id, collected_at, tissue_type_id, 
          tissue_form, tissue_volume_ml, tissue_weight_g,
          consent_received, consent_document,
          contract_number, contract_date,
          inf_hiv, inf_hbv, inf_hcv, inf_syphilis, 
          status, note, created_at)

-- tissue_form: 'LIQUID' | 'SOLID'
-- status: 'QUARANTINE' | 'APPROVED' | 'REJECTED'
```

### 9.3 Культуры/Лоты

```
cultures(id, culture_code, donation_id, cell_type_id, status, created_at)

culture_lots(id, culture_id, lot_index, parent_lot_id, passage, status, 
             created_at, closed_at, closed_by_id)
```

### 9.4 Контейнеры/Размещения

```
dict_container_types(id, name_ru, kind, nominal_volume_ml, area_cm2)

containers(id, container_code, culture_lot_id, container_type_id, status, 
           created_at, closed_at)

equipment_positions(id, equipment_id, parent_position_id, position_code_ru,
                    temperature_conditions_ru, capacity, position_usage)

container_placements(id, container_id, equipment_position_id, 
                     placed_at, removed_at, event_id)
```

### 9.5 Банки

```
banks(id, culture_lot_id, bank_type, created_at, cells_per_ml, 
      suspension_volume_ml, viability_percent, volume_per_vial_ml,
      freeze_type, freeze_medium_id, freeze_started_at, freeze_ended_at, 
      placed_in_cryo_at)

bank_vials(id, bank_id, container_id, vial_number, passage, 
           cells_per_ml, volume_per_vial_ml, cells_per_vial)
```

### 9.6 Инвентарь

```
inventory_items(id, category, name_ru, unit, is_active)

inventory_lots(id, item_id, lot_number, expires_at, received_at, opened_at,
               qty_remaining, status, equipment_position_id, note)

inventory_movements(id, inventory_lot_id, movement_type, qty, moved_at, 
                    event_id, note)
```

### 9.7 Справочники (v1.3)

```
-- Типы категорий сред (v1.3)
dict_media_categories(id, code, name_ru)
-- BASE_MEDIUM, SERUM, ENZYME, ADDITIVE, BUFFER, OTHER

-- Готовые среды (v1.3)
ready_media(id, code, name, category_id, sterilization_method, 
            prepared_at, expires_at, qty_ml, storage_position_id,
            status, note, created_by_id, created_at)
-- status: 'QUARANTINE' | 'ACTIVE' | 'CONSUMED'

ready_media_components(id, ready_media_id, inventory_lot_id, 
                       qty_ml, final_concentration)

-- Методы получения культуры
dict_culture_obtainment_methods(id, code, name_ru, tissue_form)
-- ENZYMATIC, EXPLANT (для SOLID)
-- GRADIENT, ISOTONIC (для LIQUID)

dict_tissue_types(id, code, name_ru)

dict_cell_types(id, tissue_type_id, code, name_ru)

dict_morphology(id, code, name_ru)

dict_contamination_types(id, code, name_ru)

dict_disposal_reasons(id, code, name_ru)
```

### 9.8 События

```
events(id, event_type, event_at, user_id, culture_id, culture_lot_id, 
       equipment_id, note, corrects_event_id)

event_containers(event_id, container_id, role)
-- role: 'source', 'result', 'observed'

event_metrics(event_id, confluence_percent, morphology_id, 
              contamination_flag, contamination_note, 
              cells_per_ml, suspension_volume_ml, viability_percent)

event_inventory(event_id, inventory_lot_id, qty, unit)

event_ready_media(event_id, ready_media_id, qty_ml)  -- v1.3

lot_splits(id, event_id, source_lot_id, new_lot_id)

event_photos(id, event_id, content_type, file_name, bytes, created_at)

isolation_procedures(id, event_id, method_code,      -- v1.3
                     dissociation_medium_id, wash_medium_id,
                     gradient_medium_id, isotonic_medium_id,
                     start_time, end_time, duration_minutes)
```

### 9.9 QC-тесты (v1.3)

```
qc_tests(id, test_type, culture_id, culture_lot_id, bank_id,
         performed_at, result, notes, performed_by_id)
-- test_type: 'MYCOPLASMA', 'STERILITY', 'LAL', 'PHENOTYPE', 'INFECTION'
-- result: 'PENDING', 'PASSED', 'FAILED'
```

### 9.10 Заявки от заказчиков (v1.3)

```
customer_orders(id, order_code, customer_name, customer_contacts,
                cell_type_id, tissue_type_id, quantity_required,
                delivery_date, order_type,
                status, created_at, notes)
-- order_type: 'MCB_CREATION', 'CELL_DELIVERY'
-- status: 'NEW', 'IN_PROGRESS', 'COMPLETED', 'CANCELLED'
```

### 9.11 Документы

```
document_versions(id, doc_type, culture_id, culture_lot_id, created_at, 
                  user_id, file_name, content_type, bytes, sha256, note)
-- doc_type: 'WORKSHEET', 'CULTURE_PASSPORT'
```

### 9.12 Оборудование/Позиции

```
rooms(id, name_ru, cleanliness_class)

dict_equipment_types(id, code, name_ru, temperature_example)

equipment(id, equipment_code, equipment_type_id, manufacturer_code, 
          manufacturer_name, model_name, serial_number, inventory_number, 
          room_id, status, last_service_at, next_service_at, 
          last_validation_at, next_validation_at, created_at)
```

---

## 10. Готовые питательные среды (v1.3)

### 10.1 Назначение

Создание готовых питательных сред из компонентов справочника инвентаря. Готовая среда учитывается как отдельная сущность со своим сроком годности и QR-кодом.

### 10.2 Категории сред

| Код | Название | Примеры |
|-----|----------|---------|
| BASE_MEDIUM | Базовая среда | DMEM, RPMI, Ham's F12 |
| SERUM | Сыворотка | FBS, BCS |
| ENZYME | Ферменты | Трипсин, Коллагеназа |
| ADDITIVE | Добавки | Антибиотики, Глутамин |
| BUFFER | Буфер | PBS, HEPES |
| OTHER | Иное | — |

### 10.3 Создание готовой среды

**Ввод оператора:**
- Название (например "Среда для культивирования 10% FBS")
- Категория
- Метод стерилизации: фильтрация / автоклавирование
- Компоненты: выбор из партий инвентаря + объём каждого
- Объём готовой среды (мл)
- Срок годности: автоматически (мин. из компонентов) или вручную
- Место хранения (обязательно для ACTIVE)
- Статус: QUARANTINE (по умолчанию)

**Автоматический расчёт:**
```
final_concentration = (component_qty_ml / total_qty_ml) × исходная_концентрация
```

**Автосписание:** объём каждого компонента списывается из партии

### 10.4 QR-код и этикетка

**QR-код:** `RM:{code}` (например `RM-0001`)

**Этикетка готовой среды:**
```
┌─────────────────────────────────────────────┐
│ RM-0001                                     │ ← QR
│ Среда для культивирования 10% FBS           │
│ Состав: DMEM 90% + FBS 10%                  │
│ Объём: 500 мл                               │
│ Годен до: 15.02.2026                        │
│ Хранение: Холодильник 1 / Полка 3           │
│ Статус: АКТИВНА (или КАРАНТИН)              │
└─────────────────────────────────────────────┘
```

### 10.5 Использование в манипуляциях

В формах (подкормка, пассаж, заморозка, разморозка) оператор выбирает:
- **Простая среда** — партия из `inventory_lots` (как сейчас)
- **Готовая среда** — из `ready_media` со статусом ACTIVE

---

## 11. Заявки от заказчиков (v1.3)

### 11.1 Назначение

Учёт заявок на создание мастер-банка или выдачу клеток от внешних заказчиков.

### 11.2 Поля заявки

| Поле | Описание |
|------|----------|
| Код | ORD-0001 (автогенерация) |
| Заказчик | ФИО, организация, контакты |
| Тип клеток | Из справочника |
| Тип ткани | Из справочника |
| Требуемое количество | Количество клеток |
| Срок выполнения | Дата |
| Тип заявки | MCB_CREATION / CELL_DELIVERY |
| Статус | NEW / IN_PROGRESS / COMPLETED / CANCELLED |

### 11.3 Связь с культурой

При создании MCB — заявка связывается с культурой через `order_id` в `cultures`.

При выдаче — заявка связывается с операцией выдачи.

---

## 12. Контроль качества (QC) (v1.3)

### 12.1 Назначение

Учёт тестов контроля качества для банков и культур.

### 12.2 Типы тестов

| Код | Название | Описание |
|-----|----------|----------|
| MYCOPLASMA | Микоплазма | Тест на отсутствие микоплазмы |
| STERILITY | Стерильность | Тест на отсутствие бактерий/грибов |
| LAL | Эндотоксин | Тест на лизат амебоцитов |
| PHENOTYPE | Фенотип | Опционально: характеристика фенотипа |
| INFECTION | Инфекции | Тесты как у донора |

### 12.3 Привязка

QC-тест привязывается к:
- Банку (`bank_id`)
- Культуре (`culture_id`)
- Лоту (`culture_lot_id`)

### 12.4 Статусы

- **PENDING** — ожидает проведения
- **PASSED** — пройден (культура/банк готов к использованию)
- **FAILED** — не пройден (культура/банк непригоден)

### 12.5 Влияние на выдачу

- При статусе донации `QUARANTINE` — выдача **запрещена**
- При статусе QC `FAILED` — выдача **запрещена**
- При статусе QC `PASSED` — выдача **разрешена**

---

## 13. Дашборд (v1.3)

### 13.1 Задачи (повторяющиеся)

Система автоматически формирует задачи на основе правил:

| Задача | Условие | Периодичность |
|--------|---------|---------------|
| Осмотр культуры | Последний осмотр > 3 дней назад | Каждые 3 дня |
| Подкормка | Последняя подкормка > 3 дней назад | Каждые 3 дня |
| FEFO | expires_at < текущая дата + 7 дней | Постоянно |
| Обслуживание оборудования | next_service_at < текущая дата + 14 дней | Постоянно |
| Валидация оборудования | next_validation_at < текущая дата + 14 дней | Постоянно |

**Действия в задаче:** "Выполнить" (открывает форму) или "Отменить" (сбрасывает счётчик).

### 13.2 Уведомления (одноразовые)

| Уведомление | Условие |
|-------------|---------|
| QC-тест готов | result заполнен |
| Заявка скоро дедлайн | delivery_date < текущая дата + 3 дня |
| Критический FEFO | expires_at <= сегодня |
| Оборудование требует внимания | status = MAINTENANCE |

### 13.3 Интерфейс дашборда

```
┌─────────────────────────────────────────────────────────┐
│  LabPro  │  Пользователь: Иванов И.И.  [Выход]          │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  ┌─ ЗАДАЧИ ───────────────────────────────────────────┐│
│  │ ☑ Осмотр CT-0001 (последний: 27.01)              ││
│  │ ☑ Подкормка CT-0002 (последняя: 26.01)           ││
│  │ ☑ FEFO: DMEM/F12 истекает 15.02                  ││
│  │ ☑ Обслуживание INC-01 через 15 дней              ││
│  └────────────────────────────────────────────────────┘│
│                                                         │
│  ┌─ УВЕДОМЛЕНИЯ ─────────────────────────────────────┐│
│  │ ⚠ QC: CT-0001 — тест на микоплазму готов        ││
│  │ ⚠ Заявка ORD-0001 — срок 05.02                  ││
│  │ ⚠ Оборудование CRYO-01 — валидация              ││
│  └────────────────────────────────────────────────────┘│
│                                                         │
│  ┌─ СТАТИСТИКА ──────────────────────────────────────┐│
│  │ Всего культур: 5  │  Активных: 3                  ││
│  │ На пассаже P2: 2  │  Банков: 4                    ││
│  └────────────────────────────────────────────────────┘│
│                                                         │
└─────────────────────────────────────────────────────────┘
```

---

## 14. Аутентификация (v1.2)

### 14.1 Web-версия (десктоп)

- Простая HTTP-аутентификация
- Логин + пароль (bcrypt)
- JWT токены для сессий
- Refresh token механизм

### 14.2 PWA (мобильные устройства)

- Биометрия (FaceID/TouchID)
- Push-уведомления для подтверждения операций

### 14.3 Безопасность

- Хранилище паролей: bcrypt
- Сессии: JWT (15 минут)
- Refresh token: 7 дней
- HTTPS обязателен

---

## 15. REST API

### 15.1 QR

`GET /api/qr/resolve?code=...`

### 15.2 Операции

- `POST /api/operations/create-culture`
- `POST /api/operations/inspection`
- `POST /api/operations/feed`
- `POST /api/operations/passage`
- `POST /api/operations/bank-freeze`
- `POST /api/operations/bank-thaw`
- `POST /api/operations/place`
- `POST /api/operations/issue` — простая выдача
- `POST /api/operations/issue-with-thaw` — выдача с манипуляцией (v1.3)
- `POST /api/operations/dispose`
- `POST /api/operations/isolation` — процедура выделения (v1.3)

### 15.3 Готовые среды (v1.3)

- `POST /api/ready-media` — создание
- `GET /api/ready-media` — список
- `GET /api/ready-media/{id}` — карточка
- `PUT /api/ready-media/{id}/status` — смена статуса
- `POST /api/ready-media/{id}/print-label` — печать этикетки

### 15.4 Заявки (v1.3)

- `POST /api/orders` — создание
- `GET /api/orders` — список
- `GET /api/orders/{id}` — карточка
- `PUT /api/orders/{id}/status` — обновление статуса

### 15.5 QC-тесты (v1.3)

- `POST /api/qc-tests` — создание
- `GET /api/qc-tests` — список
- `PUT /api/qc-tests/{id}/result` — результат теста

### 15.6 Дашборд (v1.3)

- `GET /api/dashboard/tasks` — задачи
- `GET /api/dashboard/notifications` — уведомления
- `POST /api/dashboard/tasks/{id}/complete` — выполнить задачу
- `POST /api/dashboard/tasks/{id}/cancel` — отменить задачу

### 15.7 Справочники

- CRUD для всех справочников

---

## 16. Документы (PDF)

### 16.1 Рабочий лист

По культуре + лот (опционально).

### 16.2 Паспорт культуры

По культуре, с версионированием.

---

## 17. Roadmap

**Этап 1** — стабилизация v1.3 (после MVP)
- Шаблоны результатов операций
- Умный выбор позиции
- Быстрый сценарий "Скан → действие"
- Готовые среды
- Заявки от заказчиков

**Этап 2** — расширение домена (v1.4+)
- Несколько типов клеток/тканей
- Конфигурируемые протоколы
- QC-модуль
- Дашборд с задачами

**Этап 3** — GMP-готовность (v2)
- Электронные подписи
- Hold/Quarantine
- Девиации/CAPA

**Этап 4** — интеграции (v3)
- Принтер-сервер
- Температурные логгеры
- LIMS/ERP

---

*Документ версии 1.3 от 30.01.2026*
