# TODO: Реализация LabPro

**Дата обновления:** 09.02.2026
**Статус:** Фазы 1-15 завершены. Тестирование полного цикла.

---

## Этап 1: Исправление статусов ✅
- [x] Container status — ACTIVE, DISPOSE, IN_BANK
- [x] Order status — NEW, IN_PROGRESS, COMPLETED, CANCELLED

## Этап 2: Формы операций ✅
- [x] Passage, Freeze, Feed, Observe, Dispose, Thaw

## Этап 3: Ready Media ✅
## Этап 4: Tasks ✅
## Этап 5: Notifications ✅
## Этап 6: Документы ✅ (Worksheet, Culture Passport)
## Этап 7: Навигация ✅ (Header + мобильное меню)
## Этап 8: Карточки сущностей ✅
## Этап 9: Бизнес-логика ✅
## Этап 10: Чистка ✅

## Этап 11: Багфиксы после тестирования ✅
- [x] Redirect операций на карточку культуры
- [x] container_status вместо status для контейнеров
- [x] Защита утилизированных контейнеров от операций
- [x] Метки типов операций SEED, FEEDING, QC
- [x] Fallback типов культур при отсутствии связи tissue_type → culture_type

## Этап 12: Доработка форм и схемы номенклатур ✅
- [x] Форма пассажа: 5 шагов (Источник → Среды → Метрики → Результат → Подтверждение)
- [x] Форма пассажа: обязательные среды (диссоциация, промывка, посев)
- [x] Форма пассажа: доступ к готовым средам + реагентам/ферментам
- [x] Форма пассажа: площадь, объём, плотность посева в контейнерах
- [x] Форма пассажа: размещение (инкубатор) обязательно
- [x] Форма создания культуры: множественный выбор типов контейнеров
- [x] Форма создания культуры: остатки на складе по container_type_id FK
- [x] БД: surface_area_cm2, volume_ml, optimal_confluent для container_types
- [x] БД: container_type_id FK в nomenclatures (вместо fuzzy-matching)
- [x] БД: новые типы контейнеров DISH-35, DISH-60, DISH-100
- [x] Убраны __none__ SelectItem (ошибка UUID parse в Supabase)
- [x] Страница /references: склад → /inventory

## Этап 13: Контаминация, объёмы сред, навигация ✅
- [x] Контаминация: авто-карантин (container_status → QUARANTINE)
- [x] Контаминация: уведомление типа CONTAMINATION
- [x] Карточка культуры: Alert + Badge для контаминированных контейнеров
- [x] Карточка культуры: кнопка «Утилизировать»
- [x] Форма пассажа: поля объёма (мл) для всех сред
- [x] Форма пассажа: множественные типы контейнеров (container_groups)
- [x] Форма пассажа: фильтр позиций по INCUBATOR
- [x] API: operation_media.quantity_ml + seed media
- [x] Навигация: «Склад» (/inventory) + «Справочники» (/references)
- [x] Dispose: batch_status ACTIVE → AVAILABLE
- [x] Карточка партии: тип контейнера + площадь + объём

## Этап 14: Улучшения форм, чистка данных ✅
- [x] Контаминация: исправлен createNotification (link_type/link_id)
- [x] Утилизация: Badge «Контаминация», авто-привязка, предзаполнение причины
- [x] Карточка культуры: alert исчезает после утилизации, кнопка передаёт container_ids
- [x] Пассаж Step 4: переработан по паттерну создания культуры (контейнеры + среда + объём)
- [x] Пассаж: списание расходников со склада + inventory_movement
- [x] Пассаж: обновление current_volume_ml у seed medium
- [x] Кормление: режим «Индивидуальное кормление» (разная среда/объём на контейнер)
- [x] Чистка справочников: морфологии (5), причины утилизации (8)
- [x] Чистка тестовых данных (культуры, лоты, контейнеры, операции, донации)

## Этап 15: Упрощение контейнеров, позиции инкубаторов, компоненты ✅
- [x] БД: нормализация equipment.type — все инкубаторы «INCUBATOR»
- [x] БД: создание 15 позиций (3 полки × 5 инкубаторов) — positions были пустые
- [x] Контейнеры: единый Select со склада (партия → авто-списание, убраны лишние шаги)
- [x] Пассаж Step 4: расчёт клеток/см² (общая площадь + плотность посева)
- [x] Пассаж Step 4: инкубатор dropdown заполнен (ранее был пустой)
- [x] Пассаж Step 4: режим индивидуальной среды + дополнительные компоненты
- [x] Создание культуры: контейнер со склада (1 Select), индивидуальная среда, компоненты
- [x] Кормление: дополнительные компоненты (сыворотка, реагенты, добавки)

## Этап 16: Тестирование полного цикла ⏳
- [x] Багфикс: генерация кодов контейнеров (409 Conflict duplicate key containers_code_key)
- [x] Багфикс: ReferenceError «Cannot access before initialization» в форме пассажа
- [x] Редактирование складских позиций (inventory/[id] — inline edit form)
- [x] Чистка БД: удалены осиротевшие данные неудачного пассажа (лот, контейнеры, операция)
- [ ] Полный цикл Донор → Донация → Культура → Пассаж → Банк → Выдача
- [ ] Все CRUD на Supabase
- [ ] Деплой на Vercel

---

**Прогресс: 99%** — 15 из 16 этапов выполнены, багфиксы фазы 16 в процессе
